{% load i18n %}
{% load static %}
{% load mathfilters %}
{% load dict_filters %}

<!-- Product card styles moved to style.css -->

<div class="product-card text-center"
     data-product-id="{{ product.pk }}"
     data-product-variant-id="{% if product.variants.first %}{{ product.variants.first.pk }}{% endif %}">
    {% with main_image=product.get_main_image hover_image=product.get_hover_image %}
    <div class="position-relative product-image-wrapper">
        {% if product.is_on_sale %}
            <div class="sale-badge">{% trans "Sale" %}</div>
        {% endif %}
        <a href="{{ product.get_absolute_url }}">
            {% if main_image %}
                <img src="{{ main_image.image_resized.url }}"
                     alt="{{ product.name }}"
                     loading="lazy"
                     class="product-img">
                <img src="{% if hover_image %}{{ hover_image.image_resized.url }}{% else %}{{ main_image.image_resized.url }}{% endif %}"
                     alt="{{ product.name }}"
                     loading="lazy"
                     class="product-img hover-switch-img">
            {% else %}
                <img src="{% static 'shop/images/no_image.png' %}"
                     alt="{% trans 'No Image' %}"
                     loading="lazy"
                     class="product-img">
            {% endif %}
        </a>
        <div class="product-icons">
             <button type="button"
                class="wishlist-btn btn-icon-action {% if product.id in products_in_wishlist_ids %}active{% endif %}"
                data-action="wishlist-toggle"
                data-product-id="{{ product.id }}"
                title="{% if product.id in products_in_wishlist_ids %}{% trans 'Remove from Wishlist' %}{% else %}{% trans 'Add to Wishlist' %}{% endif %}">
                <i class="{% if product.id in products_in_wishlist_ids %}fas fa-heart{% else %}far fa-heart{% endif %}"></i>
            </button>

            {# Cart button - use data-action for event delegation #}
            <button type="button"
               class="cart-btn btn-icon-action"
               data-action="cart-add"
               data-product-id="{{ product.id }}"
               title="{% trans 'Add to Cart' %}">
               <i class="fas fa-shopping-cart"></i>
            </button>
        </div>
    </div>
    {% endwith %}

    <div class="product-info mt-2">
        <div class="product-name">{{ product.name }}</div>
        <div class="price-area">
            {% if product.is_on_sale %}

                <span class="original-price">
                {% if currency == 'EGP' %}
                {{ product.price_egp_no_sale|floatformat:2 }} EGP
            {% else %}
                {{ product.price_usd_no_sale|floatformat:2 }} USD
            {% endif %}
                </span>
            <span class="sale-price"> {% if currency == 'EGP' %}
                {{ product.price_egp|floatformat:2 }} EGP
            {% else %}
                {{ product.price_usd|floatformat:2 }} USD
            {% endif %}
        </span>
            {% else %}
                <span class="regular-price"> {% if currency == 'EGP' %}
                {{ product.price_egp_no_sale|floatformat:2 }} EGP
            {% else %}
                {{ product.price_usd_no_sale|floatformat:2 }} USD
            {% endif %}
        </span>
            {% endif %}
        </div>
{% if product.vendor %}
<div class="card-footer card-footer-vendor">
    <div class="vendor-info">
        <span class="vendor-name">{{ product.vendor.vendorprofile.store_name }}</span>
        <span class="vendor-rating"><i class="fa-solid fa-star"></i></span>
    </div>
    {% if product.vendor.vendorprofile.slug %}
    <a href="{% url 'shop:vendor_detail' slug=product.vendor.vendorprofile.slug %}"
       class="btn btn-light btn-sm rounded-pill ms-2 btn-view-vendor"
       title="{% trans 'View Vendor Profile' %}">
       <i class="fa-solid fa-store"></i> {% trans 'View Profile' %}
    </a>
    {% endif %}
</div>
{% endif %}

    </div>
    <div class="local-toast-container"></div>
</div>
