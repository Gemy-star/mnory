{% load static i18n %}

<!-- Top Promo Bar -->
<div class="promo-banner" id="promoBanner">
    <div class="container d-flex flex-row align-items-center justify-content-between flex-wrap">
        <!-- Language Dropdown -->
        <div class="promo-item">
            <div class="dropdown language-dropdown">
                <a style="text-decoration: none; cursor: pointer;" class="dropdown-toggle" type="button"
                   id="languageDropdown-promo" data-bs-toggle="dropdown" aria-expanded="false">
                   <span class="material-icons">language</span>
                   <span class="d-none d-md-inline">{% trans "Language" %}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown-promo">
                    {% for lang_code, lang_name in LANGUAGES %}
                    <li>
                        <form action="{% url 'set_language' %}" method="post" class="d-inline">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ request.path }}">
                            <input type="hidden" name="language" value="{{ lang_code }}">
                            <button type="submit" class="dropdown-item {% if LANGUAGE_CODE == lang_code %}active{% endif %}">
                                {{ lang_name }}
                            </button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Currency Dropdown -->
        <div class="promo-item">
            <div class="dropdown currency-dropdown">
                <a style="text-decoration: none; cursor: pointer;" class="dropdown-toggle" type="button"
                   id="currencyDropdown-promo" data-bs-toggle="dropdown" aria-expanded="false">
                   <span class="material-icons">payments</span>
                   <span class="d-none d-md-inline">
                       {% if request.session.currency %}
                           {{ request.session.currency }}
                       {% else %}
                           USD
                       {% endif %}
                   </span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="currencyDropdown-promo">
                    <li>
                        <button type="button" class="dropdown-item {% if request.session.currency == 'USD' or not request.session.currency %}active{% endif %}"
                                onclick="setCurrency('USD')">
                            USD - US Dollar
                        </button>
                    </li>
                    <li>
                        <button type="button" class="dropdown-item {% if request.session.currency == 'EGP' %}active{% endif %}"
                                onclick="setCurrency('EGP')">
                            EGP - Egyptian Pound
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <!-- User Account -->
        <div class="promo-item">
            {% if user.is_authenticated %}
                <a href="{% url 'shop:order_history' %}" style="color: inherit; text-decoration: none;">
                    <span class="material-icons">person</span>
                    <span class="d-none d-md-inline">{{ user.username }}</span>
                </a>
            {% else %}
                <a href="{% url 'shop:login' %}" style="color: inherit; text-decoration: none;">
                    <span class="material-icons">person</span>
                    <span class="d-none d-md-inline">{% trans "Login" %}</span>
                </a>
            {% endif %}
        </div>
    </div>
</div>

<!-- Main Header/Navbar -->
<header class="header" id="mainHeader">
    <div class="container">
        <div class="header-content">
            <!-- Left Section: Menu + Categories + Search -->
            <div class="header-left d-flex align-items-center gap-3">
                <!-- Hamburger Menu Button (Mobile) - Opens Mobile Menu Drawer -->
                <button class="icon-btn hamburger-btn d-lg-none"
                        type="button"
                        id="hamburgerMenuBtn"
                        title="{% trans 'Menu' %}">
                    <span class="material-icons">menu</span>
                </button>

                <!-- Pages Menu Button (Desktop) - Opens Pages Drawer -->
                <button class="icon-btn pages-menu-btn d-none d-lg-flex"
                        type="button"
                        id="pagesDrawerBtn"
                        title="{% trans 'Menu' %}">
                    <span class="material-icons">reorder</span>
                </button>

                <!-- Categories Button (Desktop) - Opens Categories Drawer -->
                <button class="icon-btn categories-btn d-none d-lg-flex"
                        type="button"
                        id="categoriesDrawerBtn"
                        title="{% trans 'Browse Categories' %}">
                    <span class="material-icons">apps</span>
                </button>

                <!-- Desktop Search -->
                <div class="search-box d-none d-md-block">
                    <form action="{% url 'shop:home' %}" method="get" class="d-flex position-relative">
                        <input type="text"
                               name="search"
                               class="form-control"
                               placeholder="{% trans 'Search products...' %}"
                               aria-label="{% trans 'Search' %}">
                        <button type="submit" class="btn-theme position-absolute" style="right: 5px; top: 50%; transform: translateY(-50%);">
                            <span class="material-icons">search</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Center Section: Logo -->
            <div class="header-center">
                <a href="{% url 'shop:home' %}" class="logo text-decoration-none">
                        <img src="{% static 'images/logo.png' %}" alt="MNORY" class="logo-img" style="height: 50px;">
                </a>
            </div>

            <!-- Right Section: Icons -->
            <div class="header-right d-flex align-items-center gap-3">
                <!-- Mobile Search Toggle -->
                <button class="icon-btn d-md-none"
                        type="button"
                        data-bs-toggle="modal"
                        data-bs-target="#searchModal"
                        title="{% trans 'Search' %}">
                    <span class="material-icons">search</span>
                </button>

                <!-- Theme Toggle -->
                <button class="icon-btn"
                        type="button"
                        id="themeToggle"
                        title="{% trans 'Toggle Dark Mode' %}"
                        aria-label="{% trans 'Toggle between light and dark themes' %}">
                    <span class="material-icons theme-icon-light">light_mode</span>
                    <span class="material-icons theme-icon-dark" style="display: none;">dark_mode</span>
                </button>

                <!-- Wishlist -->
                <a href="{% url 'shop:wishlist_view' %}"
                   class="icon-btn position-relative"
                   title="{% trans 'Wishlist' %}">
                    <span class="material-icons">favorite</span>
                    <span class="badge bg-danger position-absolute top-0 start-100 translate-middle"
                          id="wishlist-count">0</span>
                </a>

                <!-- Cart -->
                <a href="{% url 'shop:cart_view' %}"
                   class="icon-btn position-relative"
                   title="{% trans 'Cart' %}">
                    <span class="material-icons">shopping_cart</span>
                    <span class="badge bg-danger position-absolute top-0 start-100 translate-middle"
                          id="cart-count">0</span>
                </a>
            </div>
        </div>

        <!-- Mobile Search Bar (Below Header) -->
        <div class="mobile-search-container d-md-none mt-3" id="mobileSearchContainer">
            <form action="{% url 'shop:home' %}" method="get" class="d-flex position-relative">
                <input type="text"
                       name="search"
                       class="form-control"
                       placeholder="{% trans 'Search products...' %}"
                       aria-label="{% trans 'Search' %}">
                <button type="submit" class="btn-theme position-absolute" style="right: 5px; top: 50%; transform: translateY(-50%);">
                    <span class="material-icons">search</span>
                </button>
            </form>
        </div>
    </div>
</header>

<!-- Mobile Menu Drawer -->
<div class="menu-drawer" id="menuDrawer">
    <div class="menu-drawer-overlay" id="menuDrawerOverlay"></div>
    <div class="menu-drawer-content">
        <!-- Drawer Header -->
        <div class="menu-drawer-header">
            <a href="{% url 'shop:home' %}" class="drawer-logo text-decoration-none mx-auto">
                <img src="{% static 'images/logo-black.png' %}" alt="MNORY" class="drawer-logo-img drawer-logo-light">
                <img src="{% static 'images/logo.png' %}" alt="MNORY" class="drawer-logo-img drawer-logo-dark" style="display: none;">
            </a>
            <button class="menu-drawer-close" id="menuDrawerClose" aria-label="{% trans 'Close menu' %}">
                <span class="material-icons">close</span>
            </button>
        </div>

        <!-- Mobile Quick Actions Bar (Only visible on mobile) -->
        <div class="mobile-drawer-actions d-lg-none">
            <!-- Theme Toggle -->
            <button class="mobile-action-btn" id="mobileDrawerThemeToggle" title="{% trans 'Toggle Theme' %}">
                <span class="material-icons mobile-theme-icon-light">light_mode</span>
                <span class="material-icons mobile-theme-icon-dark" style="display: none;">dark_mode</span>
                <span class="action-label">{% trans "Theme" %}</span>
            </button>
        </div>

        <!-- Drawer Body -->
        <div class="menu-drawer-body">
            <!-- User Account Section -->
            <div class="drawer-nav">
                {% if user.is_authenticated %}
                    <a href="{% url 'shop:order_history' %}" class="drawer-user-info">
                        <div class="drawer-user-avatar">
                            <span class="material-icons">person</span>
                        </div>
                        <div>
                            <div class="drawer-user-name">{{ user.username }}</div>
                            <div class="drawer-user-email text-theme-muted">{% trans "View Account" %}</div>
                        </div>
                    </a>
                {% else %}
                    <a href="{% url 'shop:login' %}" class="drawer-menu-item">
                        <span class="drawer-icon-circle">
                            <span class="material-icons">login</span>
                        </span>
                        <span>{% trans "Login / Register" %}</span>
                    </a>
                {% endif %}
            </div>

            <div class="drawer-divider"></div>

            <!-- Main Navigation -->
            <nav class="drawer-nav">
                <a href="{% url 'shop:home' %}" class="drawer-menu-item">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">home</span>
                    </span>
                    <span>{% trans "Home" %}</span>
                </a>

                <a href="{% url 'shop:search_products' %}" class="drawer-menu-item">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">storefront</span>
                    </span>
                    <span>{% trans "Shop" %}</span>
                </a>

                <!-- Wishlist (Desktop only, mobile has quick actions) -->
                <a href="{% url 'shop:wishlist_view' %}" class="drawer-menu-item d-none d-lg-flex">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">favorite</span>
                    </span>
                    <span>{% trans "Wishlist" %}</span>
                    <span class="drawer-badge" id="drawer-wishlist-count">0</span>
                </a>

                <!-- Cart (Desktop only, mobile has quick actions) -->
                <a href="{% url 'shop:cart_view' %}" class="drawer-menu-item d-none d-lg-flex">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">shopping_cart</span>
                    </span>
                    <span>{% trans "Cart" %}</span>
                    <span class="drawer-badge" id="drawer-cart-count">0</span>
                </a>

                {% if user.is_authenticated %}
                    <a href="{% url 'shop:order_history' %}" class="drawer-menu-item">
                        <span class="drawer-icon-circle">
                            <span class="material-icons">history</span>
                        </span>
                        <span>{% trans "Order History" %}</span>
                    </a>
                {% endif %}

                <div class="drawer-divider"></div>

                <!-- Categories Section -->
                <div class="drawer-menu-item drawer-categories-toggle" id="drawerCategoriesToggle">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">label</span>
                    </span>
                    <span>{% trans "Categories" %}</span>
                    <span class="material-icons drawer-chevron">expand_more</span>
                </div>

                <div class="drawer-submenu" id="drawerCategoriesSubmenu">
                    {% if categories %}
                        {% for cat in categories %}
                            <a href="{{ cat.get_absolute_url }}" class="drawer-submenu-item">
                                {{ cat.name }}
                            </a>
                        {% endfor %}
                    {% else %}
                        <div class="drawer-submenu-item text-theme-muted">
                            {% trans "No categories available" %}
                        </div>
                    {% endif %}
                </div>

                <div class="drawer-divider"></div>

                <!-- Additional Links -->
                <a href="#" class="drawer-menu-item">
                    <span class="drawer-icon-circle">
                        <span class="material-icons">mail</span>
                    </span>
                    <span>{% trans "Contact Us" %}</span>
                </a>

                {% if user.is_authenticated %}
                    <a href="#" class="drawer-menu-item">
                        <span class="drawer-icon-circle">
                            <span class="material-icons">settings</span>
                        </span>
                        <span>{% trans "Settings" %}</span>
                    </a>
                {% endif %}
            </nav>

            <div class="drawer-divider"></div>

            <!-- Theme Toggle in Drawer (Desktop only, mobile has quick actions) -->
            <div class="drawer-section d-none d-lg-block">
                <button class="drawer-menu-item drawer-theme-toggle" id="drawerThemeToggle">
                    <span class="drawer-icon-circle">
                        <span class="material-icons drawer-theme-icon-moon">dark_mode</span>
                        <span class="material-icons drawer-theme-icon-sun" style="display: none;">light_mode</span>
                    </span>
                    <span class="drawer-theme-text">{% trans "Dark Mode" %}</span>
                    <div class="drawer-toggle-switch">
                        <div class="drawer-toggle-thumb"></div>
                    </div>
                </button>
            </div>

            <!-- Logout (if authenticated) -->
            {% if user.is_authenticated %}
                <div class="drawer-divider"></div>
                <div class="drawer-section">
                    <form action="{% url 'shop:logout' %}" method="post" style="margin: 0;">
                        {% csrf_token %}
                        <button type="submit" class="drawer-menu-item text-danger">
                            <span class="drawer-icon-circle drawer-icon-danger">
                                <span class="material-icons">logout</span>
                            </span>
                            <span>{% trans "Logout" %}</span>
                        </button>
                    </form>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Search Modal -->
<div class="modal fade search-modal" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header border-theme">
                <h5 class="modal-title text-theme" id="searchModalLabel">
                    <span class="material-icons me-2">search</span>{% trans "Search Products" %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 'shop:home' %}" method="get">
                    <div class="position-relative">
                        <input type="text"
                               name="search"
                               class="form-control form-control-lg"
                               placeholder="{% trans 'Search for products...' %}"
                               autocomplete="off">
                        <button type="submit" class="btn-theme position-absolute d-none d-md-block" style="right: 10px; top: 50%; transform: translateY(-50%);">
                            <span class="material-icons">search</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Categories Drawer -->
<div class="categories-drawer" id="categoriesDrawer">
    <div class="categories-drawer-overlay" id="categoriesDrawerOverlay"></div>
    <div class="categories-drawer-content">
        <!-- Drawer Header -->
        <div class="categories-drawer-header">
            <h2 class="categories-drawer-title">
                <span class="material-icons">label</span>
                {% trans "Browse Categories" %}
            </h2>
            <button class="categories-drawer-close" id="categoriesDrawerClose" aria-label="{% trans 'Close categories' %}">
                <span class="material-icons">close</span>
            </button>
        </div>

        <!-- Drawer Body -->
        <div class="categories-drawer-body">
            <!-- Tab Navigation -->
            <div class="categories-drawer-tabs">
                <button class="categories-tab active" data-tab="search">
                    <span class="material-icons">search</span>
                    {% trans "Search" %}
                </button>
                <button class="categories-tab" data-tab="categories">
                    <span class="material-icons">apps</span>
                    {% trans "Categories" %}
                </button>
            </div>

            <!-- Tab Content -->
            <div class="categories-tab-content">
                <!-- Search Tab -->
                <div class="categories-tab-pane active" id="searchTab">
                    <!-- Search Box -->
                    <div class="categories-drawer-search">
                        <form class="d-flex position-relative" onsubmit="return false;">
                            <input type="text"
                                   id="categorySearchInput"
                                   class="form-control"
                                   placeholder="{% trans 'Search categories...' %}"
                                   autocomplete="off"
                                   aria-label="{% trans 'Search categories' %}">
                            <button type="button" class="btn-theme position-absolute" style="right: 5px; top: 50%; transform: translateY(-50%);">
                                <span class="material-icons">search</span>
                            </button>
                        </form>
                    </div>

                    <!-- Search Results List -->
                    <div class="category-search-list" id="searchResults">
                        {% if categories %}
                            {% for cat in categories %}
                                <a href="{{ cat.get_absolute_url }}"
                                   class="category-search-item category-item"
                                   data-name="{{ cat.name|lower }}">
                                    <span class="category-search-icon">
                                        {% if cat.image %}
                                            <img src="{{ cat.image.url }}"
                                                 alt="{{ cat.name }}"
                                                 class="category-search-image">
                                        {% else %}
                                            <div class="category-search-placeholder">
                                                {{ cat.name|slice:":1" }}
                                            </div>
                                        {% endif %}
                                    </span>
                                    <div class="category-search-content">
                                        <span class="category-search-title">{{ cat.name }}</span>
                                        <span class="category-search-subtitle">{% trans "Browse products" %}</span>
                                    </div>
                                </a>
                            {% endfor %}
                        {% else %}
                            <div class="no-categories">
                                <span class="material-icons">search_off</span>
                                <p>{% trans "No categories found." %}</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Categories Tab -->
                <div class="categories-tab-pane" id="categoriesTab">
                    <!-- Category Grid -->
                    {% if categories %}
                        <div class="category-grid">
                            {% for cat in categories %}
                                <a href="{{ cat.get_absolute_url }}"
                                   class="category-card">
                                    {% if cat.image %}
                                        <img src="{{ cat.image.url }}"
                                             alt="{{ cat.name }}"
                                             class="category-card-image">
                                    {% else %}
                                        <div class="category-card-placeholder">
                                            {{ cat.name|slice:":1" }}
                                        </div>
                                    {% endif %}
                                    <div class="category-card-name">
                                        {{ cat.name }}
                                    </div>
                                </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="no-categories">
                            <span class="material-icons">inventory_2</span>
                            <p>{% trans "No categories available." %}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pages/Menu Drawer (Desktop Only) -->
<div class="pages-drawer d-none d-lg-block" id="pagesDrawer">
    <div class="pages-drawer-overlay" id="pagesDrawerOverlay"></div>
    <div class="pages-drawer-content">
        <!-- Drawer Header -->
        <div class="pages-drawer-header">
            <h2 class="pages-drawer-title">
                <span class="material-icons">explore</span>
                {% trans "Explore" %}
            </h2>
            <button class="pages-drawer-close" id="pagesDrawerClose" aria-label="{% trans 'Close menu' %}">
                <span class="material-icons">close</span>
            </button>
        </div>

        <!-- Drawer Body -->
        <div class="pages-drawer-body">
            <!-- Navigation Links -->
            <nav class="pages-nav">
                <a href="{% url 'shop:home' %}" class="pages-menu-item">
                    <span class="pages-icon-circle">
                        <span class="material-icons">home</span>
                    </span>
                    <div class="pages-item-content">
                        <span class="pages-item-title">{% trans "Home" %}</span>
                        <span class="pages-item-subtitle">{% trans "Main page" %}</span>
                    </div>
                </a>

                <a href="{% url 'shop:search_products' %}" class="pages-menu-item">
                    <span class="pages-icon-circle">
                        <span class="material-icons">storefront</span>
                    </span>
                    <div class="pages-item-content">
                        <span class="pages-item-title">{% trans "Shop" %}</span>
                        <span class="pages-item-subtitle">{% trans "Browse all products" %}</span>
                    </div>
                </a>

                {% if user.is_authenticated %}
                    <a href="{% url 'shop:order_history' %}" class="pages-menu-item">
                        <span class="pages-icon-circle">
                            <span class="material-icons">history</span>
                        </span>
                        <div class="pages-item-content">
                            <span class="pages-item-title">{% trans "Order History" %}</span>
                            <span class="pages-item-subtitle">{% trans "Track your orders" %}</span>
                        </div>
                    </a>
                {% endif %}

                <div class="pages-divider"></div>

                <a href="#" class="pages-menu-item">
                    <span class="pages-icon-circle">
                        <span class="material-icons">info</span>
                    </span>
                    <div class="pages-item-content">
                        <span class="pages-item-title">{% trans "About Us" %}</span>
                        <span class="pages-item-subtitle">{% trans "Learn more about us" %}</span>
                    </div>
                </a>

                <a href="#" class="pages-menu-item">
                    <span class="pages-icon-circle">
                        <span class="material-icons">mail</span>
                    </span>
                    <div class="pages-item-content">
                        <span class="pages-item-title">{% trans "Contact Us" %}</span>
                        <span class="pages-item-subtitle">{% trans "Get in touch" %}</span>
                    </div>
                </a>

                <a href="#" class="pages-menu-item">
                    <span class="pages-icon-circle">
                        <span class="material-icons">support_agent</span>
                    </span>
                    <div class="pages-item-content">
                        <span class="pages-item-title">{% trans "Support" %}</span>
                        <span class="pages-item-subtitle">{% trans "Help & FAQs" %}</span>
                    </div>
                </a>

                {% if user.is_authenticated %}
                    <div class="pages-divider"></div>

                    <a href="#" class="pages-menu-item">
                        <span class="pages-icon-circle">
                            <span class="material-icons">settings</span>
                        </span>
                        <div class="pages-item-content">
                            <span class="pages-item-title">{% trans "Settings" %}</span>
                            <span class="pages-item-subtitle">{% trans "Account preferences" %}</span>
                        </div>
                    </a>
                {% endif %}
            </nav>
        </div>
    </div>
</div>

<!-- Category Search and Theme Toggle JavaScript moved to main.js -->
<!-- All Header CSS moved to static/css/styles.css -->
